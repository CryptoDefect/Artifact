// SPDX-License-Identifier: MIT

// X: https://x.com/sprmeth
// Telegram: https://t.me/sprmeth
// Website: https://spectrum.bid

// Audited by DARPA

// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWX0kxdoooooodxk0XWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNOoc;,..............,;coOXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXxc,...'','''''''''''''''...,cxXMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0l,..''''''''''''''''''''''''''..,l0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKl..'''''''''''''''''''''''''''''','..lKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMNx'.',''''''''''''''''''''''''''''''''''.'dNMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMWX0kxddo:.......'','''''''''''''''''''''''''.......;oodxk0XWMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMNOdlllccloc..:cc::;,'....''''''''''''''''''........''''..,;;,;:cldONMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMNOoccldk0000Oc'lddddddddoc;,...''''''''''''.....',;;;;;;;;,.'lllllc:;;:lkNMMMMMMMMMMMMM
// MMMMMMMMMMMXdccok00000000o':dddddddddddddo:'..''''''''....,;;;;;;;;;;;;;'.;llllllllc;,:dKMMMMMMMMMMM
// MMMMMMMMMNd:cx0000000000O:,oddddddddddddddddc,..''''...';;;;;;;;;;;;;;;;;.'cllllllllllc,,oXMMMMMMMMM
// MMMMMMMWO::x000000000000x,;dddddddddddddddddddc'.....';;;;;;;;;;;;;;;;;;;'.:llllllllllllc,;OWMMMMMMM
// MMMMMMWx;lO0000000000000d':ddddddddddddddddddddo'  .,;;;;;;;;;;;;;;;;;;;;'.;llllllllllllll;,dNMMMMMM
// MMMMMWd,o000000000000000d,:ddddddddddddddddddddl,,;'';;;;;;;;;;;;;;;;;;;;'.;lllllllllllllll:'oNMMMMM
// MMMMMx,l0000000000000000k;;dddddddddddddddddddo'cXNd.,;;;;;;;;;;;;;;;;;;;'.cllllllllllllllll:'dWMMMM
// MMMMK;:O00000000000000000c'ldddddddddddddddddd;;0MMX:.;;;;;;;;;;;;;;;;;;,.,llllllllllllllllll,,0MMMM
// MMMMd'd000000000000000000x,;dddddddddddddddddl'oWMMMx.';;;;;;;;;;;;;;;;;'.:llllllllllllllllll:.oWMMM
// MMMWc;k0000000000000000000o,:dddddddddddddddx:'kMMMM0,.;;;;;;;;;;;;;;;;'.;llllllllllllllllllll':NMMM
// MMMN::O0000000000000Okdollc'.,::::clodddddddd:,OMMMMX;.;;;;;;;;,,'''''...,;;;:clllllllllllllll';KMMM
// MMMNc;O000000000kdlccc:cllooc',xkxdolc::ldddx:,OMMMMK;.;;;;,'';cldxkx:.',,,''''',,:cllllllllll':XMMM
// MMMWo,x000000koc::coxkkkkkkkkd::kNMMWN0xl::ldc'xMMMMO'';,',cdOXWMMWO:',:;;:::::;,,'',;cllllllc.cWMMM
// MMMMk,l0000kl;:lxkkkkkkkkkkkkkko:cxXMMMMMXkl:;.cNMMWo..':xKWMMMMNkc,,;:::::::;;::::;,'',cllll;'xMMMM
// MMMMNl;x0kl;cdkkkkkkkkkkkkkkkkkkkoccokXWMMMW0o..xMM0'.cONMMMMNOo:,,;::::::::;:::::::::;'.,clc'cXMMMM
// MMMMMK:;l;:dkkkkkkkkkkkkkkkkkkkkkkkxlccldk0XWW0;;xk:;kNWX0kdl;,';::::;::::::::::;:::::::;'.;';0MMMMM
// MMMMMMO,.ckkkkkkkkkkkkkkkkkkkkkkkkkkkkkdl:,',:cc.  .:l:,'..',;::::::;;:::::::::::;;::;:::;,..kMMMMMM
// MMMMMWd,';okkkkkkkkkkkkkkkkkkkkkkkkkkdl:clodxkkc',;':xkxolc;'',;:::;:::::::::::::;;::::::;...oNMMMMM
// MMMMWx,lxc,cxkkkkkkkkkkkkkkkkkkkkkdc:coOXWMMWKc.cXNd.;OWMMWXOdc,',:::::::::::::::::::::;'.':,.dWMMMM
// MMMMK;;xkkdc;cdkkkkkkkkkkkkkkkkko:cd0WMMMMWOo;.,KMMX:.'ckNMMMMWKx:,,;:::::::;:::;::::;'.';ccc',0MMMM
// MMMMd'okkkkkdc::cdkkkkkkkkkkkko::kNMMMMN0dc:ll'oWMMMx.,,,:oONMMMMNOc',::::::;::::;;''.';ccccc;.oWMMM
// MMMWc,xkkkkkkkkoc:::codxkkkkxc;xNWNKkdoc:cdxkc'kMMMM0,'::;,,;ldk0XWNk;';:::;;,,''''';:ccccccc:.:NMMM
// MMMN:;kkkkkkkkkkkkxoc::ccc::'.;olllc:coxkkkkk:,OMMMMX;.::::::;,',;:cl;...'''''',;::ccccccccccc';XMMM
// MMMNc,xkkkkkkkkkkkkkkkkkxdl''loodxkkkkkkkkkkk:,OMMMMK;'::::::::::::;;;,..,:::ccccccccccccccccc.;XMMM
// MMMWo'dkkkkkkkkkkkkkkkkkkx;,okxkkkkkkkkkkkkkkl'xMMMMO''::::::::::::::::;..:cccccccccccccccccc:.cWMMM
// MMMMk,ckkkkkkkkkkkkkkkkkkl'ckkkkkkkkkkkkkkkkkx,cNMMWo.;:::::::::::::::::,.,cccccccccccccccccc,.xMMMM
// MMMMNl,dkkkkkkkkkkkkkkkkx;,dkkkkkkkkkkkkkkkkkkl,xWMO,':::::::::::::::::::..:cccccccccccccccc:.cNMMMM
// MMMMMK:;xkkkkkkkkkkkkkkko':kkkkkkkkkkkkkkkkkkxx:;dk:.::::::::::::::::::::'.,ccccccccccccccc:.;0MMMMM
// MMMMMMK:;dkkkkkkkkkkkkkkl'ckkkkkkkxkkkkkkkkkkkkx;. .;::::::::::::::::::::'.,cccccccccccccc:';0MMMMMM
// MMMMMMMKl;okkkkkkkkkkkkko':kkkkkkkkkkkkkkkkkkkxc,::,'::::::::::::::::::::'.,ccccccccccccc;':KMMMMMMM
// MMMMMMMMNx::dkkkkkkkkkkkd,;xkkkkkkkkkkkkkkkkxl;:kXNOc',::::::::::::::::::'.;ccccccccccc;',dNMMMMMMMM
// MMMMMMMMMMXd::okkkkkkkkkk:'okkkkkkkkkkkkkkdc;:xKNNNNXk:'';::::::::::::::;.':ccccccccc;',oKMMMMMMMMMM
// MMMMMMMMMMMMXxl:coxkkkkkkd,;xkkkkkkxkkxdl::lkXNNNNNNNNXkl;',;:::::::::::'.;cccccc:;',:dXMMMMMMMMMMMM
// MMMMMMMMMMMMMMWKxlccclodxko,:xkkxxolc::clx0NNNNNNNNNNNNNNKxl:;',,;;::::'.,c::;,',;cd0WMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMN0kdolllc;.':cclllox0XNNNNNNNNNNNNNNNNNNNNX0xolc::;,..';::ccox0XWMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMWNXXk;;kKXNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNXKk;,kKXNWWMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMXd:dKNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNNKd:oKMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKoco0XNNNNNNNNNNNNNNNNNNNNNNNNNNN0o:l0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKdlldOXNNNNNNNNNNNNNNNNNNNNXOdlco0WMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0dooodxOKXNNNNNNNNXKOxdllloONMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWN0xdooddoooooooooooxOXWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNXK0000KXNWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM

pragma solidity =0.8.21;

import {ERC20} from "solady/tokens/ERC20.sol";
import {Owned} from "solmate/auth/Owned.sol";

import {WETH} from "solmate/tokens/WETH.sol";
import {IUniswapV2Router02} from "v2-periphery/interfaces/IUniswapV2Router02.sol";

contract Spectrum is ERC20, Owned {
    mapping(address => bool) public transferLimitImmune;

    // This is the initial max tradable amount
    // This is set lower than the final amount to prevent snipers getting too much
    // After it is changed this value will be 174747670
    // This number is 0.108% of the golden proportion
    uint256 internal max_tradable = 1747476;

    address public immutable immutable_repository;

    error Retain();
    error OverTransferLimit();

    constructor(
        address _pool,
        address _angels,
        address _exchanges,
        address _contributors,
        address _atonement
    ) payable Owned(msg.sender)  {
        // This is the Fibonacci Allocation
        uint supply = 112358132134558914423337761098715972584418167651094617711286574636875025121393;

        // This is the circulating supply
        uint golden_proportion = 161803398874;

        // Refer to documentation for percentages and explanation of distribution
        uint pool = 116498447191;
        uint angels = 14562305898;
        uint exchanges = 9708203932;
        uint contributors = 4854101966;
        uint atonement = 16180339887;
        
        assert(pool + angels + exchanges + contributors + atonement == golden_proportion);

        //The Immutable Repository is the deployer which retains the Fibonacci Allocation permanently.
        //Holders should model their behavior after the Immutable Repository and learn the power of retaining.
        immutable_repository = msg.sender;

        // Allow mints over max tradable
        transferLimitImmune[address(0)] = true;

        // Allow transfers over max tradable
        transferLimitImmune[_pool] = true;
        transferLimitImmune[_angels] = true;
        transferLimitImmune[_exchanges] = true;
        transferLimitImmune[_contributors] = true;
        transferLimitImmune[_atonement] = true;

        // Mint the fibonacci sequence
        _mint(immutable_repository, supply);

        // Mint tokens to the addresses
        _mint(_angels, angels);
        _mint(_exchanges, exchanges);
        _mint(_contributors, contributors);
        _mint(_atonement, atonement);

        _mint(_pool, pool);
    }

    function name() public pure override returns (string memory) {
        return "Spectrum";
    }
    function symbol() public pure override returns (string memory) {
        return "SPRM";
    }
    function decimals() public pure override returns (uint8) {
        return 27;
    }
    function changeTradable() public onlyOwner {
        max_tradable = 174747670;
    }

    function _beforeTokenTransfer(
        address from,
        address to,
        uint256 amount
    ) internal view override {
        // Cannot read immutable variables from assembly
        address repo = immutable_repository;
        /// @solidity memory-safe-assembly
        assembly {
            // If 'from' is the Immutable Repository then revert
            if eq(repo, from) {
                // Store revert signature in memory
                mstore(0x00, 0x7c53b42a)
                revert(0x1c, 0x04) // Revert with Retain()
            }
            // If amount > max tradable check if 'from' is immune
            // if amount is less than max tradable continue to transfer()
            if gt(amount, sload(max_tradable.slot)) {
                // Store from and immunity storage slot in memory for hashing
                mstore(0x00, from)
                mstore(0x20, transferLimitImmune.slot)
                // load the hashed value to get storage hash of value
                // if 'from' is not immune then revert
                // 'from' must be set to true from constructor
                // Only those addresses will not trigger this revert here
                if iszero(sload(keccak256(0x00, 0x40))) {
                    // Store revert signature in memory
                    mstore(0x00, 0xb26fb503)
                    revert(0x1c, 0x04) // Revert with OverTransferLimit()
                }
            }
        }
    }

    function _constantNameHash() internal pure override returns (bytes32 result) {
        // keccak256(bytes("Spectrum"))
        return 0x7a19dfb547ec25cf2f18bf07f0ba0d617689900af227b2911fa9e71b22422ac4;
    }
}