// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@,,@@@@@,,,,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@,,     ,,,,     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@   (@@       ,,,,           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@            ,,,,,,           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@((((.....,,,,,,,,...        (((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@,,,,,,,,,,,,,,,,           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@##,,________,,,,,,,,,,,           ((((@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@,,,==========,,,,,,,,,,,,,,,           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@,,,__________,,,,,,,,,,,,,,,           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@,,,,,,,,,,,,,,, ,,,,,,,,,,,,,,,             @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@/////****,,,,,,,,,,,,,,  ,,,,,,,,           @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@////   ////,,,,,,,,,,,,    ,,,,,,,,,,,                  @@@@@@@@@@@@@@@@@               @@@@@@@@@@@       @@@@@@@@@@@@
// @@////// //////,,,,,...   ,,,,,,,,,,,,,,           ,,,,,,                           ,,,,,,     ((               @@@@@@@@
// @@@@////////////////@@@@  ,,,,,,,,,,,,,,,,       ,,,,,,,,,,,,,,,,,,,,,         ,,,,,,,,,,,,,,,,   @@@@@           @@@@@@
// @@@@%%%///////////%%@@@@  ,,,,,,,,,,,,,,,,......,,,,,,,,,,,,,,,,,,,,,,...  ....,,,,,,,,,,,,,,,,..((((@@           (((@@@
// @@@@@@@@@@@@@@@@@@@@@@@@  ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,    @@@@@           @@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@   ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,    @@@@@           @@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,    @@@@@           @@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@  ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,    @@@@@           @@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@   ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,    @@           @@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,  @@@@@@         @@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,  ,,,,,,,,,,,,,,,,,,,,,,,,,  @@@@@@         @@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  ,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,   ,,,,,,,,,,,,,,,,,,,   @@@@@@@@         @@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     ,,,,,,,,,,,,,    ,,,,,,,,,,,,,     ,,,,,,,,,,,,,,,,,   @@@@@@@@@@@           @@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@       ,,,,,,,,,  @@@@             @@@@@,,,,,,,,,,,,,,,       @@@@@@@@@@@      @@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@,,,,,,,,,  @@@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,,,,,           @@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@####,,,,,..@@@@@@@@@@@@@@@@@@@@@@####,,,,,,,,,,,           @@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@,,,,,,,@@@@@@@@@@@@@@@@@@@@@@@@@@,,,,,,,,,,,           @@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     ((@@@@@@##,,,((@@@@@@@@@@@@@@@@@@@@@@@@@@@@,,,....@@(((((      @@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@     @@@@@@@@@@,,,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@,,,    @@@@@@@      @@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@(   @@@@@@@@@@@@@,,,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#,,,@@@@@@@@@      @@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@      @@@@@@@@@@@,,,,,@@@@@@@@@@@@@@@@@@@@@@@@@@,,,,,  @@@@@@         @@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@//,,,,    @@@@@@@/////,,  @@@@@@@@@@@@@@@@@@@@//////,,,@@@@@@//,,,  @@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@//////,,@@@@@@@@@///////@@@@@@@@@@@@@@@@@@@@@@/////////@@@@@@/////,,@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
pragma solidity ^0.8.10;


import "erc721a/extensions/ERC721ABurnable.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/cryptography/MerkleProof.sol";
import "@openzeppelin/contracts/interfaces/IERC20.sol";
import "@openzeppelin/contracts/interfaces/IERC2981.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/token/ERC721/extensions/ERC721Enumerable.sol";
import "@openzeppelin/contracts/token/ERC1155/IERC1155.sol";

contract BlackSandMounts is ERC721ABurnable, Ownable, ReentrancyGuard {
       enum ReleaseMode{ CLOSED, DEV, PRE_SALE, OPEN, ENDED }
      ReleaseMode public currentMode;

      mapping(address => uint256) private _mintedPerAddress;
      bytes32 private _presaleMerkleRoot;
      uint256 private MAX_PER_ADDRESS = 2;
      uint256 public currentMaxSupply = 2345;
      uint256 public maxSupply = 10000;
      uint256 public price = 15000000000000000;
      string public baseTokenURI = "https://forgottenbabies.com/blacksand/uri/";
      bool public baseTokenURILocked;
      address private _aeAddress;
    


  // Simple Eth check, assuming no freebies.
  modifier requireCorrectEth(uint256 mintCount) {
    require(msg.value == price * mintCount, "Sent incorrect Ether");
    _;
  }

  /// @param mintCount The amount of heroes intended to be minted.
  /// @dev All of our validations that we check before a mint.
  modifier validateMint(uint256 mintCount) {
     require(
        _mintedPerAddress[msg.sender] + mintCount <= MAX_PER_ADDRESS,
        "Exceeds wallet limit"
    );
    require(totalSupply() + mintCount <= currentMaxSupply, "Would exceed current max supply");
    require(totalSupply() + mintCount <= maxSupply, "Would exceed max supply");
    _;
 }

     modifier validatePreSaleAction() {
      require(currentMode == ReleaseMode.PRE_SALE || currentMode == ReleaseMode.OPEN, "Not presale time yet");
      _;
    }

 /// @dev Dev time?
 modifier validateDevsAction() {
   require(currentMode == ReleaseMode.DEV, "Not dev time yet");
   _;
 }


 /// @dev The constructor!
 constructor()
     
     ERC721A("BlackSandMounts", "BSMOUNTS")
 {
  
 }

 function setPrice(uint256 newPrice) public onlyOwner {
   price = newPrice;
 }
 function generalMinting(uint mintCount) validateMint(mintCount) requireCorrectEth(mintCount) nonReentrant external payable {
     require(currentMode == ReleaseMode.OPEN, "It's not go time yet.");
     mint(msg.sender, mintCount, true);
 }

 /**
 @param merkleProof Your Merkle proof to check that you're on the presale list.
 @param mintCount Amount to mint.
 @notice This is the mint function called by folks before the general sale, assuming they're allow-listed.
 @dev We don't need to enforce any specific limits on number of presale units minted, since the allow list itself
 will limit participants, plus the limit of mints per address checked in `validateBuild`.
 */
 function preSaleMint(bytes32[] memory merkleProof, uint mintCount) validateMint(mintCount) validatePreSaleAction nonReentrant external payable {
   bytes32 leaf = keccak256(abi.encodePacked(msg.sender));
      require(MerkleProof.verify(merkleProof, _presaleMerkleRoot, leaf), "Not on allowlist");


   uint mintFeesToCharge = mintCount;
   require(msg.value == price * mintFeesToCharge, "Sent incorrect Ether");
   mint(msg.sender, mintCount, true);
 }


 /// @dev This is a one-time operation! Don't mess it up!
 function lockBaseTokenURI() external onlyOwner {
   baseTokenURILocked = true;
 }

  function setPresaleMerkleRoot(bytes32 merkRoot) external onlyOwner {
   _presaleMerkleRoot = merkRoot;
 }

 /// @param baseTokenURI_ The new baseTokenURI
 /// @dev Need this so we can set the new base URI for the cut over to permaweb.
 function setBaseURI(string memory baseTokenURI_) external onlyOwner {
     require(!baseTokenURILocked, "setBaseURI is locked");
     baseTokenURI = baseTokenURI_;
 }

 // Copy + pasted in the ERC721A in order to override.
 function tokenURI(uint256 tokenId) public view virtual override returns (string memory) {
     require(_exists(tokenId), "ERC721Metadata: URI query for nonexistent token");
     string memory baseURI = baseTokenURI;
     return bytes(baseURI).length > 0 ? string(abi.encodePacked(baseURI, Strings.toString(tokenId), '.json')) : "";
 }

 /// @dev Sets the various wallets for withdrawl.
 function setWalletAddresses(address a) external onlyOwner {
   _aeAddress = a;
 }

 function getWalletAddresses() view external onlyOwner returns(address aeAddress){
   return (_aeAddress);
 }

 /// @dev Set our current mode to DEV.
 function startDevTeam() external onlyOwner {
   setSaleStatus(ReleaseMode.DEV);
   mint(msg.sender, 150, false);
 }


 /// @dev Set our current mode to OPEN, for the general sale.
 function startGeneralSale() external onlyOwner {
   setSaleStatus(ReleaseMode.OPEN);
 }

  function startPreSale() external onlyOwner {
   setSaleStatus(ReleaseMode.PRE_SALE);
 

 }

 /// @dev End the sale (ENDED)
 function endSale() external onlyOwner {
   setSaleStatus(ReleaseMode.ENDED);
 }

  function setMaxMint(uint256 newNumber) external onlyOwner {
   MAX_PER_ADDRESS = newNumber;
 }


 function setCurrentMaxSupply(uint256 newNumber) external onlyOwner {
   currentMaxSupply = newNumber;
 }



 /// @dev Sets the current state to the given status.
 function setSaleStatus(ReleaseMode newStatus) private onlyOwner {
   currentMode = newStatus;
 }

 /// @dev Get paid
 function withdraw() external nonReentrant onlyOwner {
   // Some percentage magic:
   uint256 balance = address(this).balance;
   payable(_aeAddress).transfer(balance);
    }

 /// @param to Who are we minting for?
 /// @param countTowardsWalletLimit Allows us to indicate if this should count towards the "X NFTs per Wallet" limit, or if we bypass that.
 /// @dev Our internal mint method, that handles some universal book-keeping.
 function mint(address to, uint256 count, bool countTowardsWalletLimit) private {
     if(countTowardsWalletLimit){
       _mintedPerAddress[to] += count;
     }
     _safeMint(to, count);
 }




}