// SPDX-License-Identifier: MIT

/*

               `                ......      `                      .gMMWBNx,

  ` ` ` ` ` `        `      ` (H"~._?WN,`  `   `  ` `    ` ` `   .H@^.....(M,     ` ` `          `

                `       `   .HD_......?db.            `        `.M3........Jb           `  `  `

             `    `        .M'.........(MN. `   `             `.H\..`..`...-H[ `                  `

  `  `  `  `        `  `   dD....-(,....(Mr    `   `   `  `   .M3...-(--....Wb   `  `  `    `  `

              ` `  `     ` qb..`JK?vh-..-MN          `   `   .M%..-g#9vNp...db    `      `   `

   `  `   `            `   d#...?8?=vH,..JM;`   `            MD...MB==?dM-..db            `     `

             `    `       `(N-..(H?==dN-.(NL      `   ` `  `.K_.-dD?===dM!..HF   `  `  `    `  `

  `    `       `   `  `    .M]..-WS=?JM|..dN   `    `       d%.-+6=??=1HF..(M%     `     `        `

                            ?N...(Nz??Wb..(M;              .N>.dD?==?=d#_..(B`

                             WN-.(Mf??dN_.-M]              d#.(Mz=??=dM\..(M'

           ...ZvOVVVZUUVzo-...Mp..ON=?=WL..d#              Ht.ME====dMt..(H8UTYCC179X+,.

       .(UXZI<<<<<<<<?zOOtrrwGdN,.-Wy?=dN,.(M{            .N~.HI===jMD..(H8<<<~~~~~~~<<zO-.

      JSZCz;<::::::::;<<>+OZwuuMb,.(4k?zMb-.zn.-(((-.... `([email protected]<<<<~<:~:~~~:::<O,

    .d8Z1;;_(:::::;;;;:<_:<+OwwXHN,.(HugNMB"<<!_...._?7""9WgJK===?d@_(d#1+z;:<;;<;;:::::::;zn.

    dSZz11z&&+&&+++>>;;;;;<;<zZXwv$-(ME=...................._TMNejV~JMBOlz++++++>+&iJ+++<;;;vW.

   .HZXOOtOOzrwrVVHWQJ+;;>+?1zzvwo(M=...............`..`......._TMaM#HykwwOlzudH9XZXzOOXHMmxzdb

   dZZk1ll==zwllttrwzXHHa+<+zwZAd#=.......--..`...........`......_TMNkyZXuwkUVOI====uZ1?><<?NXU[

   XZXC?zzttOzWyrwrOzwrXUMmxOwWM=..-(JgNMMBWR...`....`..(J--.---...?MNNyWKHUO==?<<+1W3?>>>>><jX8

   w0I;>><1zOOOqM31zOOwwwZWMNHM!...dC?WkMN.JN_...`.`....je_dMMMMMgJ-_dMNH0Zl=z<<<<?mD?=?;<;:;:wu

   jkI~<<+?zOq#=~~<+1zlOwXXZWM!....?N,HNMB(M@.........`.JNJMNMMt(M#...dMN0z?<<~~~~.(Wmz><::::;zH

    X0_;<<<?11zjJ-_<>??zuzXX#'......_7WMMMM9~..`(JgJ,...-TNmYYi(MK!..._MMs??<~~~~~_(xY>>:~__~<d#

    Jkc_~<<<>>jF.___~<1OrwXH!....................(7=......-?TWH9^......JM#?><:~~~__W+;:~~~~~~(M%

    (Wk<~~~~<~d!  -___(zOwd\...._(((-(((J&JggQmmmmgg++JJJJJJ-----......_MN??<<_~~~.(Nx~~~~.~_J%

     XX0-~~~~(5(+d:__~(>1dNgMMMMWB9Y77C1<<:<<<<<<??77<77?C17?7TTHHMMNg.,JN2;<<~.(QaJJE<~~~~_(f

      ?Ww-~~~_<<<H~.JgH0OwU01?>><;::::::::::::::::::::::::::::::::::<TWMNM@+j.~_(k+=>><~~_(+K`

       .Wk+~~::;<v11z1==OwXI?>>;;::::::::::;:;::::::::;:::::::::::::::::jB6?zTMNg@+?;<:::+gY`

         (Sw+_:::;<>>>>+jKZz>>><++++<:::::;:;;;;;;;;;;;;:;:;;:::::(::::::Wz=????>><<<<:+&Y'

           (4y+++++>;>>+WSv<>>>+#77dMMMNmaJ+:::j+&J+:::<j+ggMMM#""Mb:~:::?Nx===?><::<jgY!

              ?zAzOz&+uXMZ1>????d/`dNMMMF`.@:(jWMgHWh+:Jb~?MNMM#~_dt::::::JNQez1&j&K@^

                    `` J#Z?>>?>?>W,`?""'.(8:+WMgmmmHNHc:?e`?"HB!..8::::::;<N.?77^`

                       dWI??>>>>?>?HaaJd8<:jHH@gggHH@HMc:?4+...JB>;;;;;;;;:d&....

                       JKZ?<>>;>;>;;;:::;<jMH@@H@@HHHHMb~::::;;;;;>;;;>>;+j9!__~(T,

                       ,NXI>?>>>>>>>>;;;;;dHHHHHHHH@HHH#(::::::;;>>>>>>>+H>_`.....(4.

                        (HkO??????>>>>;;;;+HMHHHHHHHHHMD(;::::;;>>????>>+#_.``````.-4.

                         ?HZy====??>;;;;;;;+TMMMHHHHHM@;>;;:::;;>>>>?>><;B_-``.``.._J\

                          ?MmXOz=????>>;;;>>jxzTMMMB9C>e>;;;;;:;;>>>>>+jd6+__....._(=

                            ?MNmyOzz+?++>>>??SgggMHaggd5;>;;;;;;;;>+&kH6<<<<~~__(JY`

                               ?TMNmgQyOlzl=zzltttOOOlll11+++++=ugWBC<<::::~:~-J=

                                    ?WMMNNmgggQAAAAwwwAAAggggNM9<~~?s:::~~~~~(d!

                                   JHHHHHHHHHMMMMMMMMMMMHHMMMHb~~~~~?n_~::~~(V`

                                 .MHH@H@HHMMMHMNNbbHMMHMM9zNqm@~~~~~~(N-::(d%

                                JHHH@HHH@H@MMMHMHWMHMMMQ,~(MqH@~~~~~~~_X(JY`

                              .dHHHHHMMmMHMMHHMMMMMMMHNbMp(NWHS~~~~~~~-(#`

                              dHHH@MMHHHHMMHHMM5~j~~?MNHkMcM~:d_~~~_(gM+

                             (MHHMHqqHMMBdMNMB:~~d~~~~?TBM$N~~d>~~?MH@MMb

                            -HHHMHqqHMMD~_Jl~~~~~d~~~~~~~~~d~~Jr~~(M@MN@Mb*/

pragma solidity ^0.8.17;



import "@openzeppelin/contracts/token/ERC1155/ERC1155.sol";

import "@openzeppelin/contracts/access/Ownable.sol";

import "@openzeppelin/contracts/security/Pausable.sol";

import "@openzeppelin/contracts/utils/cryptography/MerkleProof.sol";



contract YasashiiKimochi is ERC1155, Ownable, Pausable {

    string public name;

    string public symbol;



    bytes32 public merkleRoot;

    address public withdrawAddress;

    // id 0,1,2,3,4 -> SBT ①,②,③,④,pageOwner

    uint256[] public mintCost = [0.03 ether, 0.04 ether, 0.05 ether, 0.02 ether];



    // tokenIdごとにtokenURIを設定

    mapping(uint256 => string) private _tokenURIs;



    constructor() ERC1155("") {

        name = "Yasashii Kimochi SBT";

        symbol = "YKSBT";

        setURI(0, "ipfs://bafkreigelxi35gbsszb7ah7oh6labcxk4qs23dvp6nniblkd4zoui5awue");

        setURI(1, "ipfs://bafkreiarbpttaz7beswwcbiwqmfxageyhmvnwl26nsqrcxa5lw3e55nine");

        setURI(2, "ipfs://bafkreiedliw462srswpmmgwgqmmjlolubk53vjhh5zbrgurzmgtpyppbha");

        setURI(3, "ipfs://bafkreiftgzzruxjw7y7hvjvfobdkbefxqgfsbfdds6q5n5trz3o34ckmgy");

        setURI(4, "ipfs://bafkreif3ajmmqpssqeqxz4h5iogfahqqqw6llxckki5vpdpgoztds4loyq");

    }



    //// mint functions ////

    // id 0,1,2,3,4 -> SBT ①,②,③,④,pageOwner

    function publicMint(

        uint256[] calldata _ids,

        uint256[] calldata _mintAmounts,

        uint256[] calldata _allocation,

        bytes32[] calldata _merkleProof

    ) external payable whenNotPaused {

        require(msg.sender == tx.origin, "No smart contract");



        bytes32 leaf =

            keccak256(abi.encodePacked(msg.sender, _allocation[0], _allocation[1], _allocation[2], _allocation[3]));

        require(MerkleProof.verify(_merkleProof, merkleRoot, leaf), "Invalid Merkle Proof");



        uint256 totalCost;



        for (uint256 i = 0; i < _ids.length; i++) {

            require(_mintAmounts[i] > 0, "Mint more than 1");



            require(balanceOf(msg.sender, _ids[i]) + _mintAmounts[i] <= _allocation[_ids[i]], "Exceeds your allocation");



            totalCost = totalCost + mintCost[_ids[i]] * _mintAmounts[i];

        }



        require(totalCost <= msg.value, "Not enough eth");



        _mintBatch(msg.sender, _ids, _mintAmounts, "");

    }



    // id 0,1,2,3,4 -> SBT ①,②,③,④,pageOwner

    function adminMint(address to, uint256 _id, uint256 _mintAmount) public onlyOwner {

        _mint(to, _id, _mintAmount, "");

    }



    //// URI functions ////

    function setURI(uint256 tokenId, string memory tokenURI) public onlyOwner {

        _tokenURIs[tokenId] = tokenURI;

    }



    function uri(uint256 tokenId) public view virtual override returns (string memory) {

        string memory tokenURI = _tokenURIs[tokenId];

        return tokenURI;

    }



    //// pause functions ////

    function pause() public onlyOwner {

        _pause();

    }



    function unpause() public onlyOwner {

        _unpause();

    }



    //// merkletree functions ////

    function setMerkleRoot(bytes32 _merkleRoot) external onlyOwner {

        merkleRoot = _merkleRoot;

    }



    //// SBT functions ////

    function _beforeTokenTransfer(

        address operator,

        address from,

        address to,

        uint256[] memory ids,

        uint256[] memory amounts,

        bytes memory data

    ) internal override {

        require(operator == owner() || from == address(0), "this is SBT");

        super._beforeTokenTransfer(operator, from, to, ids, amounts, data);

    }



    function setApprovalForAll(address operator, bool approved) public virtual override {

        require(operator == owner(), "this is SBT");

        super.setApprovalForAll(operator, approved);

    }



    //// withdraw functions ////

    function setWithdrawAddress(address _withdrawAddress) external onlyOwner {

        withdrawAddress = _withdrawAddress;

    }



    function withdraw() external payable onlyOwner {

        require(withdrawAddress != address(0), "withdrawAddress shouldn't be 0");

        (bool sent,) = payable(withdrawAddress).call{value: address(this).balance}("");

        require(sent, "failed to move fund to withdrawAddress contract");

    }

}